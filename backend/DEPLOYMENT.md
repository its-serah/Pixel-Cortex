# Pixel Cortex Backend - Deployment Guide

## 🚀 Quick Start

### Local Development

1. **Clone the repository**
```bash
git clone https://github.com/yourusername/pixel-cortex.git
cd pixel-cortex/backend
```

2. **Set up Python environment**
```bash
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. **Install dependencies**
```bash
# For minimal deployment (no ML features)
pip install -r requirements.txt

# For full features (includes ML/AI capabilities)
pip install -r requirements-full.txt  # If available
```

4. **Set environment variables**
```bash
export DATABASE_URL="sqlite:///./pixel_cortex.db"
export SECRET_KEY="your-secret-key-here"
export AUTH_DISABLED=true  # For demo mode
export DEMO_MODE=true      # For demo mode
```

5. **Run the application**
```bash
# Basic mode (lightweight, no ML)
python run_basic.py

# Or with uvicorn directly
uvicorn run_basic:app --host 0.0.0.0 --port 8000 --reload
```

6. **Access the application**
- API Documentation: http://localhost:8000/docs
- Health Check: http://localhost:8000/health

## 🌐 Deploy to Render.com

### One-Click Deploy

1. Fork this repository to your GitHub account
2. Connect your GitHub account to Render
3. Click the button below or use the render.yaml file

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

### Manual Deployment

1. **Create a new Web Service on Render**
   - Go to https://dashboard.render.com/
   - Click "New +" → "Web Service"
   - Connect your GitHub repository

2. **Configure the service**
   - **Name**: pixel-cortex-backend
   - **Runtime**: Python 3
   - **Build Command**: `pip install -r requirements.render.txt`
   - **Start Command**: `uvicorn run_basic:app --host 0.0.0.0 --port $PORT`

3. **Set environment variables**
   ```
   DATABASE_URL=<auto-generated>
   SECRET_KEY=<generate-a-secure-key>
   AUTH_DISABLED=true  # Set to false for production
   DEMO_MODE=false     # Set to false for production
   ```

4. **Create a PostgreSQL database**
   - Add a PostgreSQL database from the Render dashboard
   - Link it to your web service

5. **Deploy**
   - Render will automatically deploy your application
   - Access via: `https://your-app-name.onrender.com`

## 🔧 Configuration

### Environment Variables

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `DATABASE_URL` | Database connection string | sqlite:///./pixel_cortex.db | Yes |
| `SECRET_KEY` | JWT secret key | - | Yes |
| `ALGORITHM` | JWT algorithm | HS256 | No |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Token expiration time | 30 | No |
| `AUTH_DISABLED` | Disable authentication | false | No |
| `DEMO_MODE` | Enable demo mode | false | No |
| `POLICIES_DIR` | Directory for policy files | ./policies | No |
| `USE_VOSK` | Enable Vosk audio processing | false | No |
| `VOSK_MODEL_URL` | Vosk model download URL | - | No (if USE_VOSK=true) |

### Database Setup

#### SQLite (Local Development)
```bash
# Automatic - database created on first run
export DATABASE_URL="sqlite:///./pixel_cortex.db"
```

#### PostgreSQL (Production)
```bash
export DATABASE_URL="postgresql://user:password@host:port/dbname"
```

## 📦 Features

### Core Features (Always Available)
- ✅ User Authentication & Authorization
- ✅ Ticket Management System
- ✅ Policy Management
- ✅ Triage Service
- ✅ Performance Monitoring
- ✅ Search Suggestions
- ✅ RESTful API

### Optional Features (Requires Additional Dependencies)
- 🔊 Audio Processing (Vosk/Whisper)
- 🤖 LLM Integration (Local or API-based)
- 🔍 Advanced Search (Sentence Transformers)
- 📊 Knowledge Graph (NetworkX, spaCy)

## 🏗️ Architecture

```
backend/
├── app/
│   ├── api/           # API endpoints
│   ├── core/          # Core functionality
│   ├── models/        # Database models
│   ├── routers/       # API routers
│   └── services/      # Business logic
├── policies/          # Policy documents
├── tests/            # Test files
├── requirements.txt   # Minimal dependencies
├── render.yaml       # Render deployment config
└── run_basic.py      # Basic application runner
```

## 🧪 Testing

```bash
# Run all tests
pytest

# Run specific test file
pytest tests/test_triage_service.py

# Run with coverage
pytest --cov=app --cov-report=html
```

## 🔍 API Endpoints

### Authentication
- `POST /api/auth/login` - User login
- `POST /api/auth/register` - User registration

### Tickets
- `GET /api/tickets/` - List tickets
- `POST /api/tickets/` - Create ticket
- `GET /api/tickets/{id}` - Get ticket
- `PUT /api/tickets/{id}` - Update ticket

### Triage
- `POST /api/triage/analyze` - Analyze and triage a ticket
- `GET /api/triage/categories` - Get available categories
- `GET /api/triage/priorities` - Get priority levels

### Performance
- `GET /api/performance/metrics` - System metrics
- `GET /api/performance/summary` - Performance summary
- `GET /api/performance/trends` - Performance trends

### Search
- `GET /api/search/suggestions` - Search suggestions

## 🐛 Troubleshooting

### Common Issues

1. **Database connection errors**
   - Ensure DATABASE_URL is correctly set
   - For PostgreSQL, verify the database exists

2. **Import errors**
   - Install missing dependencies: `pip install -r requirements.txt`
   - Use `run_basic.py` for lightweight deployment

3. **Port already in use**
   - Change port: `uvicorn run_basic:app --port 8001`
   - Kill existing process: `pkill -f uvicorn`

4. **Authentication issues**
   - Set `AUTH_DISABLED=true` for demo/testing
   - Ensure SECRET_KEY is set for production

## 📊 Monitoring

### Health Checks
- Endpoint: `/health`
- Returns: `{"status": "healthy", "service": "pixel-cortex-backend"}`

### Logs
- Local: Check terminal output
- Render: View logs in Render dashboard

## 🔐 Security

### Production Checklist
- [ ] Set strong SECRET_KEY
- [ ] Disable AUTH_DISABLED
- [ ] Disable DEMO_MODE
- [ ] Use PostgreSQL instead of SQLite
- [ ] Enable HTTPS (automatic on Render)
- [ ] Set up proper CORS origins
- [ ] Regular security updates

## 📝 License

This project is licensed under the MIT License.

## 🤝 Support

For issues and questions:
- GitHub Issues: [Create an issue](https://github.com/yourusername/pixel-cortex/issues)
- Documentation: [Read the docs](https://github.com/yourusername/pixel-cortex/wiki)
